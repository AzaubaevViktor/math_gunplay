// Generated by CoffeeScript 1.8.0
(function() {
  var Player, Snapshot, Statistic, _Model;

  Player = Model.Player;

  Statistic = Model.Statistic;

  Snapshot = Model.Snapshot;

  _Model = (function() {
    function _Model(_at_settings) {
      var structure_snapshot;
      this.settings = _at_settings;
      this.isDay = false;
      this.isGame = false;
      this.time = 0;
      this.timer = void 0;
      this.players = {
        "length": 0
      };
      this.statistic = new Statistic(this.players);
      structure_snapshot = {
        model: {
          obj: this,
          fields: ['players', 'statistic']
        }
      };
      this.snapshots = new Snapshot(structure_snapshot);
      void 0;
    }

    _Model.prototype.addPlayer = function(name) {
      var id;
      id = this.players.length;
      this.players[id] = new Player(id, name, this.settings);
      this.players.length += 1;
      return void 0;
    };

    _Model.prototype.startGame = function() {
      var player, _i, _len, _ref, _results;
      this.statistic.binds();
      _ref = this.players;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        player = _ref[_i];
        _results.push(player.setWatcher("_all", (function(_this) {
          return function(t, o, n) {
            return _this.snapshots.add();
          };
        })(this)));
      }
      return _results;
    };

    _Model.prototype.undo = function() {
      return this.snapshots.undo();
    };

    _Model.prototype.redo = function() {
      return this.snapshots.redo();
    };

    _Model.prototype.setDayTimer = function() {
      this.time = this.settings.stTime * 60;
      this.timer = setInterval((function(_this) {
        return function() {
          _this.time -= 1;
          if (_this.time <= 0) {
            _this.changeDayNight();
          } else {
            void 0;
          }
          return void 0;
        };
      })(this), 1000);
      return void 0;
    };

    _Model.prototype.changeDayNight = function() {
      clearInterval(this.timer);
      if (!this.isGame) {
        this.isGame = true;
        this.isDay = true;
      } else {
        this.isDay = !this.isDay;
      }
      if (this.isDay) {
        this.setDayTimer();
      }
      this.snapshots.clear();
      return void 0;
    };

    return _Model;

  })();

  window.Model.Model = _Model;

}).call(this);

//# sourceMappingURL=model.js.map
