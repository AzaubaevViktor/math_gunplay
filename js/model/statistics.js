// Generated by CoffeeScript 1.8.0
(function() {
  var Statistic, getValScope, observer;

  observer = Tools.observer;

  getValScope = Tools.getValScope;

  Statistic = (function() {
    function Statistic(_at_players) {
      this.players = _at_players;
      this.stats = {
        "all_damage": {
          "title": "Урона нанесено: ",
          "value": 0
        },
        "all_tasks": {
          "title": "Сыгранные задачи: ",
          "value": 0
        },
        "all_treat": {
          "title": "Вылеченно здоровья: ",
          "value": 0
        },
        "solve_percent": {
          "title": "Решённые/все задачи: ",
          "value": 0
        }
      };
      this.solved = 0;
      this.unsolved = 0;
    }

    Statistic.prototype.binds = function() {
      return this._bind_damage();
    };

    Statistic.prototype._solved_update = function() {
      this.stats.all_tasks.value = this.solved + this.unsolved;
      return this.stats.solve_percent.value = this.solved / (this.solved + this.unsolved);
    };

    Statistic.prototype._bind_damage = function() {
      var id, player, _ref, _results;
      _ref = this.players;
      _results = [];
      for (id in _ref) {
        player = _ref[id];
        if ("length" !== id) {
          observer.observe(player, "health", (function(_this) {
            return function(type, oldValue, newValue) {
              var dmg, treat;
              dmg = getValScope(oldValue - newValue, [0, +Infinity]);
              _this.stats.all_damage.value += dmg;
              treat = getValScope(newValue - oldValue, [0, +Infinity]);
              _this.stats.all_treat.value += treat;
              return console.log(dmg, treat);
            };
          })(this));
          observer.observe(player, "solved", (function(_this) {
            return function(t, o, n) {
              _this.solved += n - o;
              return _this._solved_update();
            };
          })(this));
          _results.push(observer.observe(player, "unsolved", (function(_this) {
            return function(t, o, n) {
              _this.unsolved += n - o;
              return _this._solved_update();
            };
          })(this)));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    return Statistic;

  })();

  window.Model.Statistic = Statistic;

}).call(this);

//# sourceMappingURL=statistics.js.map
